<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/shoreditch-ops/artillery#readme">artillery (v1.5.6)</a>
</h1>
<h4>Load-testing for HTTP and WebSocket-based applications</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.artillery">module artillery</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.artillery.convert">
            function <span class="apidocSignatureSpan">artillery.</span>convert
            <span class="apidocSignatureSpan">(filename)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.artillery.dino">
            function <span class="apidocSignatureSpan">artillery.</span>dino
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.artillery.quick">
            function <span class="apidocSignatureSpan">artillery.</span>quick
            <span class="apidocSignatureSpan">(url, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.artillery.report">
            function <span class="apidocSignatureSpan">artillery.</span>report
            <span class="apidocSignatureSpan">(jsonReportPath, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.artillery.run">
            function <span class="apidocSignatureSpan">artillery.</span>run
            <span class="apidocSignatureSpan">(scriptPath, options)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.artillery" id="apidoc.module.artillery">module artillery</a></h1>


    <h2>
        <a href="#apidoc.element.artillery.convert" id="apidoc.element.artillery.convert">
        function <span class="apidocSignatureSpan">artillery.</span>convert
        <span class="apidocSignatureSpan">(filename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function convert(filename) {
  let contents = fs.readFileSync(filename, 'utf8');
  if (filename.endsWith('json')) {
    let json = JSON.parse(contents);
    let yaml = YAML.dump(json);
    let newFilename = path.basename(filename, '.json') + '.yml';
    if (!fs.existsSync(newFilename)) {
      fs.writeFileSync(newFilename, yaml, 'utf8');
    } else {
      console.log(`File ${newFilename} already exists, not overwriting`);
      process.exit(1);
    }
  } else if (filename.endsWith('yml') || filename.endsWith('yaml')) {
    let yaml = YAML.load(contents);
    let json = JSON.stringify(yaml, null, 2);
    let newFilename = path.basename(filename, '.yml') + '.json';
    if (!fs.existsSync(newFilename)) {
      fs.writeFileSync(newFilename, json, 'utf8');
    } else {
      console.log(`File ${newFilename} already exists, not overwriting`);
      process.exit(1);
    }
  } else {
    console.log('File name should end with json or y[a]ml');
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.artillery.dino" id="apidoc.element.artillery.dino">
        function <span class="apidocSignatureSpan">artillery.</span>dino
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dino(options) {
  const balloon = !options.quiet ?
    ' ____________\n' +
    '&lt; artillery! &gt;\n' +
    ' ------------\n'
  :
    ' _______________________\n' +
    '&lt; You can\'t silence me! &gt;\n' +
    ' -----------------------\n';

  console.log(balloon +
'          \\\n' +
'           \\');
  let today = new Date();
  let year = today.getFullYear();
  let month = today.getMonth() + 1;
  let day = today.getDate();
  let i = year * month * day % dinos.length;
  console.log(dinos[i]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.artillery.quick" id="apidoc.element.artillery.quick">
        function <span class="apidocSignatureSpan">artillery.</span>quick
        <span class="apidocSignatureSpan">(url, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function quick(url, options) {

  var rate = options.r || options.rate;
  var duration = options.d || options.duration;
  var arrivalCount = options.c || options.count;

  let script = {
    config: {
      target: '',
      phases: [
      ],
      mode: 'uniform'
    },
    scenarios: [
      {
        flow: [

        ]
      }
    ]
  };

  let p = parse(url);
  let target = p.protocol + '//' + p.host;
  script.config.target = target;

  if (options.count &amp;&amp; options.rate) {
    console.log('Error: either a fixed number of arrivals or arrivals per ' +
                'second should be set, not both');
    process.exit(1);
  }

  if (options.insecure &amp;&amp; p.protocol.match(/https/)) {
    script.config.tls = {
      rejectUnauthorized: false
    };
  }

  if (options.rate) {
    script.config.phases.push({
      duration: options.duration || 60,
      arrivalRate: options.rate || 20
    });
  } else if (options.count) {
    script.config.phases.push({
      duration: options.duration || Math.ceil(options.count / 50),
      arrivalCount: options.count || 1
    });
  } else {
    console.log('Error: either arrival rate or an arrival count must be ' +
                'specified');
    process.exit(1);
  }

  let requestSpec = {};
  if (options.payload &amp;&amp; p.protocol.match(/http/)) {
    requestSpec.post = {
      url: url,
      headers: {'Content-Type': options.contentType || 'application/json'},
      body: options.payload || ''
    };
  } else if (options.payload &amp;&amp; p.protocol.match(/ws/)) {
    requestSpec.send = options.payload;
  } else if (p.protocol.match(/http/)) {
    requestSpec.get = {url: url};
  } else if (p.protocol.match(/ws/)) {
    requestSpec.send = 'hello from Artillery';
  } else {
    throw new Error('Unknown protocol');
  }

  if (options.num) {
    requestSpec = {
      loop: [requestSpec],
      count: options.num
    };
  }

  debug('requestSpec: %s', JSON.stringify(requestSpec, null, 2));

  script.scenarios[0].flow.push(requestSpec);
  if (p.protocol.match(/ws/)) {
    script.scenarios[0].engine = 'ws';
  }

  let tmpf = tmp.fileSync();
  fs.writeFileSync(tmpf.name, JSON.stringify(script, null, 2), {flag: 'w'});
  run(tmpf.name, {quiet: options.quiet, output: options.output});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.artillery.report" id="apidoc.element.artillery.report">
        function <span class="apidocSignatureSpan">artillery.</span>report
        <span class="apidocSignatureSpan">(jsonReportPath, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function report(jsonReportPath, options) {

  let reportFilename = options.output || jsonReportPath + '.html';

  let data = JSON.parse(fs.readFileSync(jsonReportPath, 'utf-8'));
  let templateFn = path.join(
    path.dirname(__filename),
    '../report/index.html.ejs');
  let template = fs.readFileSync(templateFn, 'utf-8');
  let compiledTemplate = l.template(template);
  let html = compiledTemplate({report: JSON.stringify(data, null, 2)});
  fs.writeFileSync(
    reportFilename,
    html,
    {encoding: 'utf-8', flag: 'w'});
  console.log('Report generated: %s', reportFilename);

  if (!options.output) {
    openfile(reportFilename);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    phase.index,
    (phase.name ? ' (' + phase.name + ')' : ''),
    phase.duration || phase.think);
  spinnerOn();
});

runner.events.on('stats', function(stats) {
  let report = stats.<span class="apidocCodeKeywordSpan">report</span>();
  intermediates.push(report);
  spinnerOff();
  log('Report for the previous %ss @ %s',
      script.config.statsInterval,
      report.timestamp);
  if (!options.quiet) {
    printReport(report);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.artillery.run" id="apidoc.element.artillery.run">
        function <span class="apidocSignatureSpan">artillery.</span>run
        <span class="apidocSignatureSpan">(scriptPath, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function run(scriptPath, options) {
  let logfile;

  // is the destination a directory that exists?
  let isDir = false;
  if (options.output &amp;&amp; options.output !== defaultOptions.output) {
    try {
      isDir = fs.statSync(options.output).isDirectory();
    } catch (err) {
      // ENOENT, don't need to do anything
    }
  }

  const defaultFormat = '[artillery_report_]YMMDD_HHmmSS[.json]';
  if (!isDir &amp;&amp; options.output) {
    // -o is set with a filename (existing or not)
    logfile = options.output;
  } else if (!isDir &amp;&amp; !options.output) {
    // no -o set
    logfile = moment().format(defaultOptions.output ||
                              defaultFormat);
  } else {
    // -o is set with a directory
    logfile = path.join(options.output, moment().format(defaultOptions.output ||
                                                        defaultFormat));
  }

  function log() {
    if (options.quiet) { return; }
    console.log.apply(console, arguments);
  }

  async.waterfall([
    async.constant(scriptPath),
    readScript,
    parseScript,
    checkTimersBug,
    checkIfXPathIsUsed,
    function(script, callback) {
      return callback(null, script, scriptPath, options);
    },
    checkConfig,
    readPayload
  ], function done(err, script) {
    if (err) {
      console.log(err.message);
      process.exit(1);
    }

    script.config.statsInterval = script.config.statsInterval || 10;

    log('Log file: %s', logfile);

      var spinnerOn = function() {
        if (!options.quiet &amp;&amp; process.stdout.isTTY) {
          cli.spinner('');
        }
      };
      var spinnerOff = function() {
        if (!options.quiet &amp;&amp; process.stdout.isTTY) {
          cli.spinner('', true);
        }
      };

      let runner = createRunner(script,
                                script.payload,
                                {
                                  environment: options.environment,
                                  // This is used in the worker to resolve
                                  // the path to the processor module
                                  scriptPath: scriptPath
                                });
      let intermediates = [];

      runner.events.on('phaseStarted', function(phase) {
        spinnerOff();
        log(
          'Phase %s%s started - duration: %ss',
          phase.index,
          (phase.name ? ' (' + phase.name + ')' : ''),
          phase.duration || phase.think);
        spinnerOn();
      });

      runner.events.on('stats', function(stats) {
        let report = stats.report();
        intermediates.push(report);
        spinnerOff();
        log('Report for the previous %ss @ %s',
            script.config.statsInterval,
            report.timestamp);
        if (!options.quiet) {
          printReport(report);
        }
        spinnerOn();
      });

      runner.events.on('done', function(allStats) {
        let report = allStats.report();
        delete report.concurrency; // doesn't make sense in this context
        delete report.pendingRequests;

        spinnerOff();
        log('all scenarios completed');
        log('Complete report @ %s', report.timestamp);

        if (!options.quiet) {
          printReport(report, { showScenarioCounts: true });
        }
        report.phases = _.get(script, 'config.phases', []);
        delete report.latencies;

        fs.writeFileSync(
          logfile, JSON.stringify({
            aggregate: report,
            intermediate: intermediates
          }, null, 2),
          {flag: 'w'});

        if (script.config.ensure) {
          const latency = report.latency;
          _.each(script.config.ensure, function(max, k) {

            let bucket = k === 'p50' ? 'median' : k;
            if (latency[bucket]) {
              if (latency[bucket] &gt; max) {
                const msg = util.format(
                  'ensure condition failed: ensure.%s &lt; %s', bucket, max);
                log(msg);
                process.exit(1);
              }
            }
          });
        }
      });

      spinnerOn();
      runner.run(); ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var runner = createRunner(opts.script, opts.payload, opts.options);

runner.on('phaseStarted', onPhaseStarted);
runner.on('phaseCompleted', onPhaseCompleted);
runner.on('stats', onStats);
runner.on('done', onDone);

runner.<span class="apidocCodeKeywordSpan">run</span>();

function onPhaseStarted(phase) {
  send({ event: 'phaseStarted', phase: phase });
}

function onPhaseCompleted(phase) {
  send({ event: 'phaseCompleted', phase: phase });
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>